/**
 * This is used to construct a netlifycms config file from js objects
 */

const yaml = require("js-yaml");
const fs = require("fs");

//base fields that are common to many content types
const baseFields = [
  { name: "title", label: "Title", widget: "string" },
  {
    label: "Permalink",
    name: "permalink",
    widget: "string",
    required: false,
    hint: "Enter a slug to control url access. Example - enter about to access this at the url domain.com/about. If blank, the title will be used.",
  },
  { name: "body", label: "Main Content", widget: "markdown" },
];

const imageField = {
  label: "Main Image",
  name: "image",
  widget: "image",
  required: false,
};
const idField = {
  name: "id",
  label: "id",
  widget: "uuid",
  hint: "read only internal identifier",
};
const seoFields = [
  {
    name: "seo",
    label: "SEO Fields",
    widget: "object",
    collapsed: true,
    fields: [
      {
        label: "Page Title",
        name: "pageTitle",
        widget: "string",
        required: false,
        hint: "Do not include an SEO suffix. One, will be appended automatically",
      },
      {
        label: "Page Description",
        name: "description",
        widget: "string",
        required: false,
        hint: "This shows mostly on search results listings",
      },
      {
        label: "No index, no follow",
        name: "noindex",
        widget: "boolean",
        required: false,
        hint: "This controls visibility to search engines.",
      },
    ],
  },
  {
    name: "og",
    label: "Open Graph Fields",
    widget: "object",
    required: false,
    collapsed: true,
    hint: "OpenGraph social sharing data. See https://ogp.me/ for more info",
    fields: [
      {
        label: "Title",
        name: "title",
        widget: "string",
        required: false,
        hint: "Sharing title.",
      },
      {
        label: "Description",
        name: "description",
        widget: "string",
        required: false,
        hint: "Sharing description.",
      },
      {
        label: "Image",
        name: "image",
        widget: "image",
        required: false,
        hint: "Sharing image - 1200Ã—630 aspect ration ~ 1.91:1 less than 1MB",
      },
    ],
  },
];

// here we start building the netlifycms config object that will be converted to the config.yml file
const config = {
  backend: {
    name: "git-gateway",
    branch: process.env.BRANCH || "master",
  },
  load_config_file: false,
  media_folder: "public/media/uploads",
  public_folder: "/media/uploads",
  show_preview_links: false,
  collections: [
    {
      label: "Pages",
      name: "pages",
      editor: {
        preview: false,
      },
      files: [
        {
          label: "Privacy Policy",
          name: "privacy-policy",
          file: "src/content/privacy-policy.md",
          fields: [...baseFields, ...seoFields],
        },
        {
          label: "Events",
          name: "events",
          file: "src/content/events/index.md",
          fields: [baseFields[0], baseFields[1], ...seoFields],
        },
      ],
    },
    {
      label: "Events",
      name: "events",
      folder: "src/content/events",
      create: true,
      label_singular: "Event",
      editor: { preview: false },
      sortable_fields: ["commit_date", "title", "date"],
      summary: "{{date}} - {{title}}",
      fields: [
        {
          name: "date",
          label: "Drop Off Date",
          widget: "datetime",
          format: "YYYY-MM-DD",
          required: true,
          hint: "The date the event will disappear from the site (is not visible)",
        },
        {
          name: "title",
          label: "Event Name",
          widget: "string",
          required: true,
        },
        {
          name: "dateDisplay",
          label: "Date Display",
          widget: "string",
          required: true,
          hint: "This shows with the event.",
        },
        { name: "description", label: "Description", widget: "text" },
        { name: "info", label: "Info Url", widget: "string", required: true },
        {
          name: "rsvp",
          label: "Register Url",
          widget: "string",
          required: true,
        },
        {
          name: "img",
          label: "Image",
          widget: "image",
          default: "/imgs/event-default.jpg",
          required: false,
        },
        {
          name: "location",
          label: "Location",
          widget: "string",
          required: false,
        },
        { name: "private", label: "Private", widget: "hidden", value: "true" },
      ],
    },
    {
      label: "Blog",
      label_singular: "Post",
      name: "blog",
      folder: "src/content/blog",
      create: true,
      editor: { preview: false },
      sortable_fields: ["commit_date", "title", "date"],
      filter: { field: "layout", value: "article.njk" },
      summary: "{{title}} ({{date}})",
      fields: [
        {
          name: "layout",
          label: "layout",
          widget: "hidden",
          value: "article.njk",
        },
        {
          name: "date",
          label: "Publish Date",
          widget: "datetime",
          format: "YYYY-MM-DD",
          required: true,
        },
        imageField,
        {
          name: "heroPosition",
          label: "Hero Image Position",
          widget: "select",
          required: true,
          options: [
            { label: "Top", value: "top" },
            { label: "Bottom", value: "bottom" },
          ],
        },
        {
          label: "Audience",
          name: "collection",
          widget: "select",
          required: true,
          options: [
            { label: "Teenage Audience", value: "teenage-audience" },
            {
              label: "Career Switcher Audience",
              value: "career-switcher-audience",
            },
          ],
        },
        {
          name: "relatedArticles",
          label: "Related Articles",
          widget: "relation",
          collection: "blog",
          search_fields: ["title"],
          value_field: "id",
          display_fields: ["title"],
          required: false,
          multiple: true,
          hint: 'Choose specific articles here to override the built in "Related Articles"',
        },
        {
          label: "Thumbnail",
          name: "thumbnail",
          widget: "image",
          hint: "~380px X ~271px",
          required: false,
        },
        {
          name: "quizId",
          label: "Quiz",
          widget: "relation",
          collection: "quizzes",
          search_fields: ["title"],
          value_field: "id",
          display_fields: ["title"],
          required: false,
        },
        {
          name: "postCta",
          label: "Post CTA",
          widget: "object",
          fields: [
            {
              label: "Headline",
              name: "headline",
              widget: "string",
              required: false,
            },
            { label: "URL", name: "url", widget: "string", required: false },
          ],
        },
        {
          name: "shortTitle",
          label: "Short Title",
          widget: "string",
          required: false,
          hint: "Shows in place of title on preview cards.",
        },
        {
          label: "Excerpt",
          name: "excerpt",
          widget: "text",
          required: false,
          hint: "SEO description will be used if not provided.",
        },
        ...baseFields,
        ...seoFields,
        {
          name: "private",
          label: "Private",
          widget: "boolean",
          required: false,
        },
        idField,
      ],
    },
    {
      label: "Landing Pages",
      label_singular: "Landing Page",
      name: "langindPages",
      folder: "src/content/landing-pages",
      create: true,
      editor: { preview: false },
      sortable_fields: ["commit_date", "title", "date"],
      fields: [
        { name: "title", label: "Title", widget: "string" },
        {
          label: "Permalink",
          name: "permalink",
          widget: "string",
          required: false,
          hint: "Enter a slug to control url access. Example - enter about to access this at the url domain.com/about. If blank, the title will be used.",
        },
        ...seoFields,
        {
          label: "Hero SVG",
          name: "jumboSvg",
          widget: "string",
          required: true,
        },
        {
          label: "Hero SVG Alt Text",
          name: "jumboSvgAltText",
          widget: "string",
          required: true,
        },
        {
          label: "Video",
          name: "video",
          widget: "object",
          fields: [
            {
              label: "Embed",
              name: "embed",
              widget: "string",
              required: false,
            },
            {
              label: "Poster Image",
              name: "poster",
              widget: "image",
              required: false,
            },
            {
              label: "Caption",
              name: "caption",
              widget: "text",
              required: false,
            },
          ],
        },
        {
          label: "Callout Section",
          name: "calloutSection",
          widget: "object",
          fields: [
            {
              label: "Headline",
              name: "headline",
              widget: "string",
              required: false,
            },
            { label: "Image", name: "img", widget: "image", required: false },
            {
              label: "Copy Items",
              name: "copyItems",
              widget: "list",
              required: false,
              fields: [
                {
                  label: "Copy",
                  name: "copy",
                  widget: "markdown",
                  required: false,
                },
              ],
            },
            {
              label: "CTA",
              name: "cta",
              widget: "object",
              collapsed: true,
              fields: [
                {
                  label: "Label",
                  name: "label",
                  widget: "string",
                  required: false,
                },
                {
                  label: "Url",
                  name: "url",
                  widget: "string",
                  required: false,
                },
              ],
            },
          ],
        },
        {
          label: "Quotes",
          name: "quotes",
          widget: "list",
          fields: [
            { label: "Copy", name: "copy", widget: "text", required: false },
            { label: "Image", name: "img", widget: "image", required: false },
            {
              label: "Attestant (who said it)",
              name: "attestant",
              widget: "string",
              required: false,
            },
            {
              label: "Attestant Details",
              name: "attestantDetails",
              widget: "string",
              required: false,
            },
            {
              label: "Image Layout",
              name: "imageLayout",
              widget: "select",
              options: ["left", "right"],
              default: ["right"],
            },
          ],
        },
        {
          label: "Carousel",
          name: "carousel",
          widget: "list",
          fields: [
            {
              label: "Headline",
              name: "headline",
              widget: "string",
              required: false,
            },
            { label: "Copy", name: "copy", widget: "text", required: false },
            { label: "Image", name: "img", widget: "image", required: false },
            {
              name: "button",
              required: false,
              widget: "object",
              collapsed: true,
              fields: [
                {
                  label: "Label",
                  name: "label",
                  widget: "string",
                  required: false,
                },
                {
                  label: "Url",
                  name: "url",
                  widget: "string",
                  required: false,
                },
              ],
            },
          ],
        },
        {
          name: "ctaBlocks",
          label: "CTA Blocks",
          required: false,
          widget: "list",
          fields: [
            {
              label: "Headline",
              name: "headline",
              widget: "string",
              required: false,
            },
            {
              label: "Suhead",
              name: "subhead",
              widget: "string",
              required: false,
            },
            {
              label: "Label",
              name: "linkLabel",
              widget: "string",
              required: false,
            },
            { label: "Url", name: "url", widget: "string", required: false },
            { label: "Image", name: "image", widget: "image", required: false },
          ],
        },
        {
          label: "Events Headline",
          name: "eventsHeadline",
          widget: "string",
          required: false,
        },
        {
          label: "Events Intro",
          name: "eventsIntro",
          widget: "text",
          required: false,
        },
        {
          name: "form",
          label: "Active Campaign Form Embed",
          widget: "text",
          required: false,
        },
        {
          name: "additionalHeadScripts",
          label: "Additional Head Scripts",
          hint: "eg. tracking snippets to go in the document head",
          widget: "text",
          required: false,
        },
        {
          name: "quizId",
          label: "Quiz",
          widget: "relation",
          collection: "quizzes",
          search_fields: ["title"],
          value_field: "id",
          display_fields: ["title"],
        },
      ],
    },
    {
      label: "Quizzes",
      label_singular: "Quiz",
      name: "quizzes",
      folder: "src/content/quizzes",
      create: true,
      editor: { preview: false },
      fields: [
        { label: "Title", name: "title", widget: "string", required: true },
        idField,
        {
          label: "Questions",
          name: "questions",
          widget: "list",
          fields: [
            {
              label: "Headline",
              name: "headline",
              widget: "string",
              required: true,
              default: "Think You Know Wood?",
            },
            {
              label: "Quiz Question",
              name: "question",
              widget: "string",
              required: true,
            },
            {
              label: "Answers",
              name: "answers",
              widget: "list",
              fields: [
                {
                  label: "Label",
                  name: "label",
                  widget: "string",
                  required: true,
                },
                {
                  label: "Explanation",
                  name: "explanation",
                  widget: "text",
                  required: true,
                },
              ],
            },
          ],
        },
      ],
    },
    {
      label: "Careers",
      name: "careers",
      folder: "src/content/careers",
      create: true,
      editor: { preview: false },
      // filter: {field: "permalink", value: "false"},
      fields: [
        { label: "Title", name: "title", widget: "string", required: true },
        {
          label: "Position",
          name: "position",
          widget: "number",
          value_type: "int",
          required: true,
          default: 0,
        },
        {
          name: "img",
          label: "Image",
          widget: "image",
          default: "/imgs/event-default.jpg",
          required: false,
        },
        {
          name: "largeImg",
          label: "Large Image",
          widget: "image",
          default: "/imgs/event-default.jpg",
          required: false,
        },
        { name: "what", label: "What", widget: "text", required: true },
        {
          name: "requirements",
          label: "Requirements",
          widget: "text",
          required: true,
        },
        { name: "skills", label: "Skills", widget: "text", required: true },
        {
          name: "certificates",
          label: "Certificates",
          widget: "text",
          required: true,
        },
        {
          name: "education",
          label: "Education",
          widget: "text",
          required: true,
        },
        { name: "salary", label: "Salary", widget: "string", required: true },
        idField,
      ],
    },
    {
      label: "About",
      name: "about",
      folder: "src/content/about",
      create: true,
      editor: { preview: false },
      fields: [
        { name: "title1", label: "Title 1", widget: "string", required: true },
        { name: "title2", label: "Title 2", widget: "string", required: true },
        { name: "title3", label: "Title 3", widget: "string", required: true },
        { name: "title4", label: "Title 4", widget: "string", required: true },
        {
          name: "description1",
          label: "Description 1",
          widget: "text",
          required: true,
        },
        {
          name: "description2",
          label: "Description 2",
          widget: "text",
          required: true,
        },
        {
          name: "description3",
          label: "Description 3",
          widget: "text",
          required: true,
        },
        {
          name: "description4",
          label: "Description 4",
          widget: "text",
          required: true,
        },
      ],
    },
    {
      label: "Videos",
      name: "videos",
      folder: "src/content/videos",
      create: true,
      editor: { preview: false },
      fields: [
        { label: "Title", name: "title", widget: "string", required: true },
        {
          label: "Description",
          name: "description",
          widget: "text",
          required: true,
        },
        {
          label: "Video Sections",
          name: "sections",
          widget: "list",
          fields: [
            { label: "Image", name: "image", widget: "image", required: true },
            { label: "Link", name: "link", widget: "string", required: true },
            { label: "Title", name: "title", widget: "string", required: true },
            {
              label: "Description",
              name: "description",
              widget: "text",
              required: true,
            },
          ],
        },
      ],
    },
    {
        label: "Get Started",
        name: "get-started",
        folder: "src/content/get-started",
        create: true,
        editor: { preview: false },
        fields: [
          { label: "Title", name: "title", widget: "string", required: true },
          {
            label: "Description",
            name: "description",
            widget: "text",
            required: true,
          },
          {
            label: "Steps",
            name: "steps",
            widget: "list",
            fields: [
              { label: "Title", name: "title", widget: "string", required: true },
              { label: "Image", name: "image", widget: "image", required: true },
              {
                label: "Description",
                name: "description",
                widget: "object",
                fields: [
                  {
                    label: "Text",
                    name: "text",
                    widget: "text",
                    required: true,
                  },
                  {
                    label: "Points",
                    name: "points",
                    widget: "list",
                    fields: [
                      {
                        label: "Point",
                        name: "point",
                        widget: "text",
                        required: true,
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      },{
        label: "Why Wood",
        name: "why-wood",
        folder: "src/content/why-wood",
        create: true,
        editor: { preview: false },
        fields: [
          { label: "Heading", name: "heading", widget: "string", required: true },
          {
            label: "Description",
            name: "description",
            widget: "text",
            required: true,
          },
          {
            label: "Sections",
            name: "sections",
            widget: "list",
            fields: [
              { label: "Heading", name: "heading", widget: "string", required: true },
              {
                label: "Description",
                name: "description",
                widget: "text",
                required: true,
              },
              {
                label: "Points",
                name: "points",
                widget: "list",
                fields: [
                  {
                    label: "Point",
                    name: "point",
                    widget: "text",
                    required: true,
                  },
                ],
              },
            ],
          },
          {
            label: "Cards",
            name: "cards",
            widget: "list",
            fields: [
              { label: "Image", name: "image", widget: "image", required: true },
              { label: "Header", name: "header", widget: "string", required: true },
              {
                label: "Description",
                name: "description",
                widget: "text",
                required: true,
              },
            ],
          },
        ],
      },
  ],
};
const data = yaml.dump(config, { noRefs: true , flowLevel: -1});
console.log(data);
